<h1><%= @user.name.capitalize %>'s Profile</h1>

<% unless friends_already?(@user) || @user.id == current_user.id %>
  <%= button_to 'Friend Me',  friend_requests_path, params: { friend_id: @user.id } %>
<% end %>

<h2>Posts</h2>

<% if current_user == @user %>
  <%= form_with model: @post, url: user_posts_path(@user), local: true do |f| %>
    <%= f.label :body %>
    <%= f.text_area :body %>
    <%= f.submit %>
  <% end %>
<% end %>

<% if @posts %>
  <% @posts.each do |post| %>
    <h4>A Post</h4>
    <p><%= post.body %></p>
    <p>Likes: <%= post.likes.count %></p>
    <%= button_to 'like', likes_path, params: { user_id: current_user.id, post_id: post.id } %>
    
    <h4>Comments</h4>
      <ul>
        <% post.comments.each do |comment| %>
          <li><%= comment.body %></li>
          <p>- <%= current_user.name %></p>
        <% end %>
      </ul>

    <%= form_with model: @comment, url: comments_path, local: true do |f| %>
      <%= f.hidden_field :post_id, value: post.id %>
      <%= f.text_area :body %>
      <%= f.submit %>
    <% end %>

  <% end %>
<% end %>

<h2>Friends</h2>
<% @user.all_friends.each do |f| %>
  <p><%= f.name %></p>
<% end %>
